<div class="jumbotron">
  <h1>IATU Topup Demo</h1>
  <p class="lead">
    <span ng-hide="vm.appDetailsSet">Please setup your application details <a ng-href="#/settings">click here</a></span>
  </p>
</div>
<div class="row marketing">
  <span ng-show="vm.productsSet() && vm.message">
    {{ vm.message }}
    <button ng-click="vm.clearMessage()">X</button></span>
  <form name="vm.form.topup" ng-show="vm.productsSet()">
    <div class="form-group">
      Country: <select ng-model="vm.selectedCountryCode" ng-options="k as v for (k, v) in vm.countries">
      </select>
    </div>
    <div class="form-group">
      Carrier: <select ng-model="vm.selectedCarrierCode" ng-options="k as k for (k, v) in vm.products[vm.selectedCountryCode]"></select>
    </div>
    <div class="form-group">
      Topup Amount:
      <select
        ng-model="vm.selectedAmount"
        ng-options="v.minDenomination as v.minDenomination  for (k, v) in vm.products[vm.selectedCountryCode][vm.selectedCarrierCode].values">
      </select>

      <span ng-if="vm.products[vm.selectedCountryCode][vm.selectedCarrierCode].openRange">
        Enter Amount : <input type="text" ng-model="vm.selectedAmount" class="form-control" />
      </span>
      <span ng-if="vm.selectedAmount && vm.inDevMode">{{ vm.selectedAmount }}</span>
    </div>
    <div>
      <button type="button" class="btn btn-info btn-md" ng-click="vm.getLocalValue()">Get Local Value</button>
      <div ng-show="vm.localValueCurrency && vm.localValueAmount">
        <div>
          <p>Your estimated local value will be: <strong>{{ vm.localValueAmount }} {{ vm.localValueCurrency }}</strong></p>
        </div>
      </div>

    </div>

    <div class="form-group">
      Phone Number:<input name='phoneNumber' class="form-control" ng-model="vm.phoneNumber" type="text" placeholder="Phone Number"/>

    </div>
    <div ng-if="vm.phoneNumber">
      <button ng-click="vm.validatePhoneNumber()">Validate Phone</button>
      <div ng-show="vm.phoneNumberValidated">
        <span ng-show="vm.phoneNumberValid">Phone Number Valid</span>
        <span ng-hide="vm.phoneNumberValid">Phone Number Invalid</span>
      </div>
      <div ng-if="vm.inDevMode && vm.validatePhoneResponse">
        {{ vm.validatePhoneResponse || json }}
      </div>
    </div>

      <button class="btn btn-success btn-lg pull-right" ng-click="vm.prepareTopup()" ng-disabled="vm.allowValidation()">
        Prepare Topup
      </button>
  </form>
  <div ng-if="vm.topUpPrepared">
    <div ng-if="!vm.prepareFailed.success">
      <span>Country : {{ vm.countries[vm.selectedCountryCode]}}</span>
      <span>Carrier : {{ vm.selectedCarrierCode }}</span>
      <span>Amount : {{ vm.selectedAmount }} | {{ vm.localValueAmount }} {{ vm.localValueCurrency }}</span>
      <span>Phone Number: {{ vm.phoneNumber }}</span>
      <p>
        <button class="btn btn-warning btn-md" ng-click="vm.resetAllValues()">Reset</button>
        <button class="btn btn-danger btn-md" ng-click="vm.cancelTopup()">Cancel</button>
        <button class="btn btn-success btn-lg" ng-click="vm.submitTopup()">Submit Topup</button>
      </p>
    </div>
    <div ng-if="vm.prepareFailed.success">
      <span>Failure to prepare the TopUp.</span>
      <span>Error : {{ vm.prepareFailed.message }}</span>
    </div>
  </div>

</div>
<div class="developer-mode" ng-show="vm.products && vm.inDevMode">
  <div>
<h3>Developer mode:</h>
  </div>
  <div id="country_code_example">
    <span ng-if="vm.selectedCountryCode && vm.inDevMode"><strong>"country_code"</strong> = "{{ vm.selectedCountryCode }}"</span>
  </div>
  <div id="carrier_code_example">
    <span ng-if="vm.selectedCarrierCode && vm.inDevMode"><strong>"carrier_code"</strong> = "{{ vm.selectedCarrierCode }}"</span>
  </div>
  <div id="amount_example">
    <span ng-if="vm.selectedAmount && vm.inDevMode"><strong>"carrier_code"</strong> = "{{ vm.selectedAmount }}"</span>
  </div>
  <span ng-if="vm.localValueCurrency && vm.localValueAmount && vm.inDevMode">
          <div>
            <strong>GET Local value response (JSON): </strong>{{ vm.localValueResults | json }}
          </div>
    <hr>
          <div>
            <p>
              Note: The Amount in Local Currency is an estimate provided by IDT to its customers for informational purposes only and may not equal the actual amount received by the end user in the applicable Country. IDT uses the foreign exchange rates posted on the website www.Oanda.com to provide this estimate. The estimate does not include any fees or taxes charged by the applicable Carrier upon conversion into the local currency. The actual amount received by the end user in the applicable Country, any fees or taxes applied to the conversion, and the actual foreign exchange rate used is determined and established by the applicable Carrier. IDT is not responsible for determining the actual amount received by the end user or for any discrepancy between the Amount in Local Currency estimate provided and the actual amount received by the end user.
            </p>
          </div>
        </span>
  <hr>
  <div id="product_list_example">
    <H4><strong>GET Products response (JSON):</strong></H4>
  <div ng-repeat="(country, product) in vm.products">
    <span>{{country}} {{ product | json }}</span>
  </div>
  </div>
</div>

